<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- metadata you need to fill in -->

        <title>Perceptually Valid Color Scale Generator</title>

        <meta name="twitter:creator" content="@JoshData" />

        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" integrity="sha256-VBrFgheoreGl4pKmWgZh3J23pJrhNlSUOBek+8Z2Gv0=" crossorigin="anonymous">

		<link href="https://fonts.googleapis.com/css?family=Bellefair|Raleway" rel="stylesheet">

        <style>
        	body {
				/* Permalink - use to edit and share this gradient: http://colorzilla.com/gradient-editor/#959595+0,0d0d0d+46,010101+50,0a0a0a+53,4e4e4e+76,383838+87,1b1b1b+100;Black+Gloss+Pipe */
				background: #959595; /* Old browsers */
				background: linear-gradient(45deg, #959595 0%,#0d0d0d 46%,#010101 50%,#0a0a0a 53%,#4e4e4e 76%,#383838 87%,#1b1b1b 100%); /* W3C, IE10+, FF16+, Chrome26+, Opera12+, Safari7+ */
				font-family: 'Raleway', sans-serif;
        	}
        	.container {
        		background-color: white;
        	}

            h1 {
            	margin: 30px 0 0 0;
                font-weight: bold;
                text-align: center;
			    font-family: 'Bellefair', serif;
            }
            p.deck {
            	margin: 0 0 30px 0;
                text-align: center;
            }

            #selects label {
                font-weight: normal;
                margin-left: 1em;
            }
                #selects label:first-child {
                    margin-left: 0;
                }

            .scale {
            	margin: 1em 0;
            	border: 1px solid #EEE;
            }
            .scale > div {
            	vertical-align: middle;
            	display: inline-block;
                padding: .5em;
                text-align: center;
            }
        </style>
    </head>
    <body>
      <div class="container">

        <h1>Color Scale Generator</h1>
        <p class="deck">Using a Perceptually Valid Color Space</p>

        <div class="panel panel-info">
        	<div class="panel-body">
        		<b>Why this page?</b>
        		There are lots of color scale generators on the web. This
        		one generates scales for continuous variables based on human color
        		perception so that neighboring colors have equal separation in both hue and lightness.
        		Lightness steps are important because not everyone can discriminate
        		hues the same way.
        	</div>
        </div>

        <form class="form">
        <div>
        	First Color:
        	<label><input type="radio" name="color1" value="#d7191c" checked> <span>Red</span></label>
        	<label><input type="radio" name="color1" value="#7b3294"> <span>Purple</span></label>
        	<label><input type="radio" name="color1" value="#d01c8b"> <span>Pink</span></label>
        	<label><input type="radio" name="color1" value="#1a9641"> <span>Green</span></label>
        	<label><input type="radio" name="color1" value="#2c7bb6"> <span>Blue</span></label>
        	<label><input type="radio" name="color1" value="#000000"> <span>Black</span></label>
        	<label><input type="radio" name="color1" value="#FFFFFF"> <span>White</span></label>
        </div>
        <div>
        	Second Color:
        	<label><input type="radio" name="color2" value="#ffffbf" checked> <span>Yellow</span></label>
        	<label><input type="radio" name="color2" value="#fdae61"> <span>Orange</span></label>
        	<label><input type="radio" name="color2" value="#f1b6da"> <span>Pink</span></label>
        	<label><input type="radio" name="color2" value="#abdda4"> <span>Green</span></label>
        	<label><input type="radio" name="color2" value="#abd9e9"> <span>Blue</span></label>
        	<label><input type="radio" name="color2" value="#000000"> <span>Black</span></label>
        	<label><input type="radio" name="color2" value="#E5E5E5"> <span>Grey</span></label>
        	<label><input type="radio" name="color2" value="#FFFFFF"> <span>White</span></label>
        </div>
        <div>
        	Divergent Scale?
        	<label><input type="radio" name="color3" value="" checked> None</label>
        	<label><input type="radio" name="color3" value="#d7191c"> <span>Red</span></label>
        	<label><input type="radio" name="color3" value="#7b3294"> <span>Purple</span></label>
        	<label><input type="radio" name="color3" value="#d01c8b"> <span>Pink</span></label>
        	<label><input type="radio" name="color3" value="#1a9641"> <span>Green</span></label>
        	<label><input type="radio" name="color3" value="#2c7bb6"> <span>Blue</span></label>
        	<label><input type="radio" name="color3" value="#000000"> <span>Black</span></label>
        	<label><input type="radio" name="color3" value="#FFFFFF"> <span>White</span></label>
        </div>
        <div id="selects" style="margin-top: 4px;">
        	<label for="numsegments">Segments:</label>
        	<select id="numsegments" name="num">
        		<option>3</option>
        		<option>5</option>
        		<option selected>9</option>
        		<option>11</option>
        		<option>13</option>
        		<option>15</option>
        	</select>

            <label for="mod">Tweak:</label>
            <select id="mod" name="mod">
                <option value="" selected>No Tweak</option>
                <option value="lighter">Lighter</option>
                <option value="darker">Darker</option>
                <option value="contrast">More Contrast</option>
            </select>
        </div>
        </form>

        <hr>

	    <div id="scale" class="scale">
    	</div>
	    <div id="hexcodes" class="scale">
    	</div>
	    <div id="rgbcodes" class="scale">
    	</div>

    	<p>Although almost everyone can discriminate hues, not everyone can discriminate the same hues or with the same fidelity. So it&rsquo;s important for the color scale to also vary in lightness. You can verify the lightness looks ok by looking at how the scale would appear to someone who cannot perceive color:</p>

        <div id="monoscale" class="scale">
        </div>

        <hr>

        <p><b>What&rsquo;s happening here?</b> You&rsquo;re probably familiar with RGB &mdash; the triple of red-green-blue color components that represents colors shown on computer monitors. Unfortunately
        math in &ldquo;RGB space&rdquo; isn&rsquo;s perceptually valid. Dividing the green component in half doesn&rsquo;t make a color half as green. Adding 50 to all of components makes the color brighter by uneven amounts depending on which color you start with. That&rsquo;s because the sensitivity of human color perception is uneven across the gamut of colors we can see, and the definition of RGB used by computer monitors doesn&rsquo;t follow human perceptual sensitivity.</p>

        <p>Color professionals have come up with alternative measurement systems for colors so that taking consistent arithmetic steps has a perceptually consistent effect. One such system replaces RGB with <a href="https://en.wikipedia.org/wiki/CIELUV">CIE 1976 L*, u*, v* (CIE LUV)</a> color space, and RGB&rsquo;s cylindrical equivalent HSL with <a href="https://en.wikipedia.org/wiki/CIELUV#Cylindrical_representation_(CIELCH)">CIELCH</a>. This page uses CIELCH to interpolate colors evenly across their lightness (L), chroma (C, similar to saturation), and hue (H).</p>

        <p>Color math is performed with <a href="https://github.com/d3/d3-color">d3-color</a>. Some of the suggested end colors are inspired by <a href="http://colorbrewer2.org">Color Brewer</a>&rsquo;s end colors.</p>

        <footer style="margin: 2em 0">
          <p>This page is on GitHub at <a href="https://github.com/JoshData/color-scales">https://github.com/JoshData/color-scales</a> and was created by <a href="https://razor.occams.info">JoshData</a>.</p>
        </footer>
      </div>

        <script src="https://code.jquery.com/jquery-3.1.1.slim.min.js" integrity="sha384-A7FZj7v+d/sdmMqp/nOQwliLvUsJfDHW+k9Omg/a/EheAdgtzNs3hpfag6Ed950n" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

        <script src="dist/color_scales.js"></script>

        <script>
function generate_scale() {
	var color1 = $('input[name=color1]:checked').val(),
    	color2 = $('input[name=color2]:checked').val(),
    	color3 = $('input[name=color3]:checked').val(),
    	numsegments = $('select[name=num]').val();

    // Apply color modifier.
    var mod = $('select[name=mod]').val();
    if (mod != "contrast") {
        color1 = modify_color(color1, mod, .25);
        color2 = modify_color(color2, mod, .25);
        color3 = modify_color(color3, mod, .25);
    } else {
        color1 = modify_color(color1, "darker", .25);
        color2 = modify_color(color2, "lighter", .25);
        color3 = modify_color(color3, "darker", .25);
    }

    // Generate the scale.
    var colors;
    if (!color3) {
        colors = color_scale(color1, color2, numsegments);
    } else {
        numsegments = parseInt(numsegments / 2) + 1;
        colors = color_scale(color1, color2, numsegments).concat(
            color_scale(color2, color3, numsegments).slice(1)
            );
    }

    // Show the scale.
    function show_scale(node, attr, textattr) {
        node.css({ minHeight: node.height() }); // prevent scroll flicker on rengeration
        node.text('');
        var width = parseInt(node.innerWidth()/colors.length);
        colors.forEach(function(color) {
            var div = $('<div>');
            div.css({
                backgroundColor: color[attr] || "inherit",
                color: attr ? color.bwcontrast : "black",
                width: width + "px",
                minHeight: textattr ? '' : (.5*width + "px"),
                fontSize: attr ? (parseInt(width/5) + "px") : '',
            });
            if (textattr)
                div.html(color[textattr])
            node.append(div);
        })
        node.css({ minHeight: '0px' }); // clear
    }

    show_scale($("#scale"), 'css');
    show_scale($("#hexcodes"), 'css', 'hex');
    show_scale($("#rgbcodes"), '', 'css');
    show_scale($("#monoscale"), 'monochrome_css');

}

function form_changed() {
    // Save to URL. The hash change listener will pick up the change.
    window.location = "#" + $('form').serialize().replace(/%23/g, "");
    generate_scale();
}

$(function() {
	$('label').each(function() {
		// Set colors on labels.
		var input = $(this).find('input');
		var span = $(this).find('span');
		span.css({
			display: 'inline-block',
			padding: '2px',
			marginRight: '3px',
			backgroundColor: input.attr('value'),
			color: get_foreground_for_color(input.attr('value')),
		})

		// Attach an event handler to update the scale.
		input.change(form_changed);
	})

	$('select').change(form_changed);

	// Detect when the page location fragment changes. And run
	// it on first load.
	$(window).on('hashchange', on_fragment_changed);
	on_fragment_changed();
	generate_scale();
	function on_fragment_changed() {
        function parse_qs(qs) {
          // Parse something that looks like a query string. Based on
          // http://stackoverflow.com/a/2880929/125992.
          var match,
            pl     = /\+/g,  // Regex for replacing addition symbol with a space
            search = /([^&=]+)=?([^&]*)/g,
            decode = function (s) { return decodeURIComponent(s.replace(pl, " ")); },
            ret = {};
          while (match = search.exec(qs))
            ret[decode(match[1])] = decode(match[2]);
          return ret;
        }

        var hash = parse_qs(window.location.hash.substring(1));
        
        $('form input').each(function() {
        	var v = hash[this.getAttribute("name")];
        	if (v) v = "#" + v; // because it's removed in URL generation
        	if (this.getAttribute("value") == v)
        		$(this).prop('checked', true);
        });
        if (hash.num)
          $('form select[name=num]').val(hash.num);
	}
});
        </script>
    </body>
</html>
